(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const f of s.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function r(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=r(o);fetch(o.href,s)}})();function w(e,t,r){let i=0;const o=e.length;for(;i<o;i++){let s=0;const f=e[i].length;for(;s<f;s++)t.call(r||this,e[i],i,e[i][s],s)}}function d(e){let t=e;if(e&&typeof e=="object"){t=Object.prototype.toString.call(e)==="[object Array]"?[]:{};for(let r in e)e.hasOwnProperty(r)&&(t[r]=d(e[r]))}return t}function U(e){let t,r,i=e.length;for(;i;t=Math.floor(Math.random()*i),r=e[--i],e[i]=e[t],e[t]=r);return e}Number.prototype.formatMoney=function(e,t,r){let i=this;const o=isNaN(e=Math.abs(e))?2:e,s=t===void 0?".":t,f=r===void 0?",":r,u=i<0?"-":"",l=parseInt(i=Math.abs(+i||0).toFixed(o))+"";let c=l.length;return c=c>3?c%3:0,u+(c?l.substr(0,c)+f:"")+l.substr(c).replace(/(\d{3})(?=\d)/g,"$1"+f)+(o?s+Math.abs(i-l).toFixed(o).slice(2):"")};function O(e){const t="â€‰";return(+e).formatMoney(0,"",t)}const I={I:function(){this.states=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]],this.color=4,this.gridX=3,this.gridY=-1,this.currentState=0},J:function(){this.states=[[[1,0,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]]],this.color=5,this.gridX=4,this.gridY=-1,this.currentState=2},L:function(){this.states=[[[0,0,1,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]]],this.color=1,this.gridX=4,this.gridY=-1,this.currentState=2},O:function(){this.states=[[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]]],this.color=2,this.gridX=3,this.gridY=0,this.currentState=0},S:function(){this.states=[[[0,1,1,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,1,0],[0,0,1,0],[0,0,0,0]],[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]]],this.color=3,this.gridX=4,this.gridY=0,this.currentState=0},T:function(){this.states=[[[0,1,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]]],this.color=6,this.gridX=4,this.gridY=-1,this.currentState=2},Z:function(){this.states=[[[1,1,0,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],[[0,1,0,0],[1,1,0,0],[1,0,0,0],[0,0,0,0]]],this.color=0,this.gridX=4,this.gridY=0,this.currentState=0}};function Z(){const e=[];for(let t in I)I.hasOwnProperty(t)&&e.push(new I[t]);return U(e)}function H(){if(n.currentFigure===null||p())return!1;clearTimeout(n.timeout);const e=y(n.field,n.currentFigure),t=R(e,n.currentFigure),r=$(t,e,n.nextFigure),i=D(r);i!==!1&&J(i.pos_x,i.state)}function R(e,t){const r=d(e),i=d(t),o=[];i.gridY<0&&(i.gridY=0);const s=i.gridX;for(let f=0;f<i.states.length;f++){++i.currentState>i.states.length-1&&(i.currentState=0),i.gridX=s;do{i.gridX--;const u=d(i);if(u.gridY=X(r,i),u.gridY!==null)o.push({figure:u,rating:C(r,u)});else break}while(!0);i.gridX=s-1;do{i.gridX++;const u=d(i);if(u.gridY=X(r,i),u.gridY!==null)o.push({figure:u,rating:C(r,u)});else break}while(!0)}return o}function X(e,t){const r=d(t);let i=null;for(;v(e,r)!==!1;)i=r.gridY++;return i}function B(e){const t=function(r,i){return r.rating<i.rating?-1:r.rating>i.rating?1:0};return e.sort(t)}function $(e,t,r){const o=B(e).slice(-2),s=[];return o.forEach(function(f){const u=v(t,f.figure);u.forEach(function(c,h){let a=!0;c.forEach(function(g){g[0]!==1&&(a=!1)}),a&&(u.splice(h,1),u.unshift(T()))});const l=D(R(u,r));l!==!1&&typeof l.rating<"u"&&(f.rating+=l.rating,s.push(f))}),s}function D(e){const t=B(e).pop();return typeof t>"u"||typeof t.figure>"u"?!1:{pos_x:t.figure.gridX,state:t.figure.currentState,rating:t.rating}}function C(e,t){const r=v(e,t);let i=0,o=0,s=0,f=0,u=0,l,c,h=null;for(;u<n.fieldX;u++){l=!0,c=n.fieldY;for(let a=0;a<n.fieldY;a++)r[a][u][0]!==1?l?c--:o++:l=!1;i+=c,h!==null&&(f+=Math.abs(h-c)),h=c}return r.forEach(function(a){let g=!0;a.forEach(function(K){K[0]!==1&&(g=!1)}),g&&s++}),.99275*s+-.66569*i+-.46544*o+-.24077*f}function J(e,t){N(!0),_(!0,t),G(!0,e),F()}function N(e){n.currentFigure.gridY<0&&e&&(e=P(),N(e))}function G(e,t){n.currentFigure.gridX!==t&&e&&(n.currentFigure.gridX>t?e=S():n.currentFigure.gridX<t&&(e=Y()),G(e,t))}function _(e,t){n.currentFigure.currentState!==t&&e&&(e=x(),_(e,t))}const n={};n.fieldX=10;n.fieldY=22;n.speedStart=1e3;n.speedStep=1;n.speedCurrent=null;n.currentFigure=null;n.nextFigure=null;n.bagFigures=[];n.timeout=null;n.field=null;n.score=null;n.startTime=null;n.isPause=!0;n.turnOnAI=!1;const V=function(){const e=[];for(let t=0;t<n.fieldY;t++)e[t]=T();return e};function T(){const e=[];for(let t=0;t<n.fieldX;t++)e.push([0,0,0,0,0]);return e}function L(){clearTimeout(n.timeout),n.isPause=!0}function k(){n.isPause=!1,b()}function p(){return n.isPause===!0}function z(){n.turnOnAI=!0,n.isPause=!1,n.startTime=new Date,n.speedCurrent=n.speedStart,n.score=0,n.field=V(),n.currentFigure=null,n.bagFigures=[],n.nextFigure=W(),q()}function W(){return n.bagFigures.length===0&&(n.bagFigures=Z()),n.bagFigures.pop()}function q(){clearTimeout(n.timeout),n.currentFigure=null,n.field=j(n.field);const e=function(){const t=n.nextFigure,r=v(n.field,t);if(r===!1)return ne(),!1;n.field=r,n.currentFigure=t,n.nextFigure=W(),Q(),E(),b(),n.turnOnAI&&H()};ee()?n.timeout=setTimeout(e,n.turnOnAI?50:900):e()}function b(){const e=function(){P()===!0?b():q()};clearTimeout(n.timeout),n.timeout=setTimeout(e,n.turnOnAI?100:n.speedCurrent)}function v(e,t){let r=!0;const i=d(e);return w(t.states[t.currentState],function(o,s,f,u){if(f!==1)return;const l=s+t.gridY,c=u+t.gridX;if(typeof i[l]>"u"||typeof i[l][c]>"u")return r=!1,!1;if(i[l][c][0]===0)i[l][c][0]=1,i[l][c][1]=t.color,i[l][c][2]=1,i[l][c][3]=0;else return r=!1,!1}),r?i:!1}function j(e){const t=d(e);return w(t,function(r,i,o){o[2]=0}),t}function Q(){const e=n.field,t=n.nextFigure;w(e,function(r,i,o){o[4]=0}),w(t.states[t.currentState],function(r,i,o,s){if(o!==1)return;const f=i+t.gridY,u=s+t.gridX;typeof e[f]>"u"||typeof e[f][u]>"u"||(e[f][u][4]=1)})}function y(e,t){const r=d(e);return t!==null&&w(t.states[t.currentState],function(i,o,s,f){if(s!==1)return;const u=o+t.gridY,l=f+t.gridX;typeof r[u]<"u"&&typeof r[u][l]<"u"&&(r[u][l][0]=0,r[u][l][1]=0,r[u][l][2]=0,r[u][l][3]=0)}),r}function A(e,t){if(p()||t===null)return!1;const r=v(e,t);return r?{field:r,figure:d(t)}:!1}function M(e){return e===!1?!1:(n.field=e.field,n.currentFigure=e.figure,E(),!0)}function P(){if(n.currentFigure===null)return;const e=d(n.currentFigure),t=y(n.field,e);return e.gridY++,M(A(t,e))}function S(){if(n.currentFigure===null)return;const e=d(n.currentFigure),t=y(n.field,e);return e.gridX--,M(A(t,e))}function Y(){if(n.currentFigure===null)return;const e=d(n.currentFigure),t=y(n.field,e);return e.gridX++,M(A(t,e))}function x(){if(n.currentFigure===null)return;const e=d(n.currentFigure),t=y(n.field,e);return++e.currentState>e.states.length-1&&(e.currentState=0),M(A(t,e))}function F(){clearTimeout(n.timeout),P()===!0?n.timeout=setTimeout(F,7):b()}function ee(){const e=[];return n.field.forEach(function(t,r){let i=!0;t.forEach(function(o){o[0]!==1&&(i=!1)}),i&&e.push(r)}),e.length>0?(e.forEach(function(t){n.field[t].forEach(function(r){r[3]=1})}),E(),e.forEach(function(t){n.field.splice(t,1),n.field.unshift(T()),n.speedCurrent-=n.speedCurrent*n.speedStep/100,n.speedCurrent<100&&(n.speedCurrent=300),n.score+=n.fieldX*e.length}),!0):!1}function te(){const e=Math.round((new Date-n.startTime)/1e3),t=Math.floor(e/3600),r=Math.floor((e-t*3600)/60),i=Math.floor(e-r*60);let o;return t>0?o=m(t)+":"+m(r)+":"+m(i):r>0?o=m(r)+":"+m(i):o=i+" sec.",o}function m(e){return e>9?e:"0"+e}function ne(){let e='<div class="popup">';e+='<div class="title">Good game!</div>',e+='<table><tr><td>Your score</td><td class="score">'+O(n.score)+"</td></tr>",e+="<tr><td>Time</td><td>"+te()+"</td></tr></table>",e+='<div class="button-box"><div class="button">Start new game</div></div>',e+="</div>";const t=document.getElementById("popup");t.innerHTML=e,L();let r;r=function(i){i.stopPropagation(),k(),z(),t.removeEventListener("click",r,!1),t.innerHTML=""},t.addEventListener("click",r,!1)}function re(){L();let e='<div class="popup">';e+='<div class="title">Paused</div>',e+='<div class="button-box"><div class="button">Resume game</div></div>',e+="</div>";const t=document.getElementById("popup");t.innerHTML=e,L();let r;r=function(i){i.stopPropagation(),k(),t.removeEventListener("click",r,!1),t.innerHTML=""},t.addEventListener("click",r,!1)}const ie=document.getElementById("window"),oe=document.getElementById("status"),se=["red","orange","yellow","green","cyan","blue","violet"];function E(){if(n.field===null)return;const e=30,t=5,r=2,i=n.fieldY/n.fieldX,o=window.innerWidth-e*2;let f=(window.innerHeight-e*2)/i;f>o&&(f=o);const u=Math.round((f-(t+r)*2)/n.fieldX),l=Math.round(u*.04);f=u*n.fieldX+(t+r)*2;let c='<div class="field-box" style="width:'+f+'px;">';n.field.forEach(function(a){c+='<div class="row">',a.forEach(function(g){c+='<div style="border-width:'+l+"px;width:"+u+"px;height:"+u+'px;" class="brick ',c+=g[0]===1?se[g[1]]:"empty",g[2]===1&&(c+=" active"),g[3]===1&&(c+=" blink"),g[4]===1&&(c+=" next"),c+='"></div>'}),c+="</div>"}),c+="</div>";let h="";h+=n.turnOnAI?'<div class="item ai-title">AI</div>':"",h+=n.score>0?`<div class="item score">${O(n.score)}</div>`:"",oe.innerHTML=h,ie.innerHTML=c}function ue(e,t,r,i,o,s){return s<r?o<e?1:o>t?3:2:s>i?o<e?7:o>t?9:8:o<e?4:o>t?6:5}function fe(){const e={bottom:[],left:[],right:[],top:[]},t=document.body.querySelectorAll(".active");let r=null;for(let o=0;o<t.length;o++)r=t[o].getBoundingClientRect(),e.bottom.push(r.bottom),e.left.push(r.left),e.right.push(r.right),e.top.push(r.top);const i=function(o,s){return o<s?-1:o>s?1:0};return e.bottom.sort(i).reverse(),e.left.sort(i),e.right.sort(i).reverse(),e.top.sort(i),{bottom:e.bottom[0],left:e.left[0],right:e.right[0],top:e.top[0]}}const ce=()=>{{const e=document.getElementById("intro");e.addEventListener("click",function(t){t.stopPropagation(),e.parentNode.removeChild(e),setTimeout(z,0)})}window.addEventListener("resize",E),window.addEventListener("keydown",function(e){p()||(e.code==="ArrowUp"?x():e.code==="ArrowRight"?Y():e.code==="ArrowLeft"&&S())}),window.addEventListener("keydown",function(e){p()||(e.code==="KeyH"&&(n.turnOnAI?n.turnOnAI=!1:(n.turnOnAI=!0,H())),e.code==="ArrowDown"?F():e.code==="Escape"&&(p()||re()))}),window.addEventListener("mousedown",function(e){if(p())return;const t=fe(),r=ue(t.left,t.right,t.top,t.bottom,e.clientX,e.clientY);r===1||r===4||r===7?S():r===3||r===6||r===9?Y():r===2||r===5?x():r===8&&F()})};ce();
